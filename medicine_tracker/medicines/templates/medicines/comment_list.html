{% extends "base.html" %}
{% block content %}
  <h2>My Medicines</h2>
  <table class="table table-striped">
    <thead>
      <tr>
        <th>Medicine</th>
        <th>Dosage</th>
        <th>Remaining Doses</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for medicine in medicines %}
      <tr>
          <td>
            <strong>{{ medicine.medicine.name }}</strong><br>
            <small class="text-muted">
                <div>ğŸ“ PoznÃ¡mka:
                    {% if medicine.notes %}
                        {{ medicine.notes }}
                    {% else %}
                        Å½Ã¡dnÃ¡ poznÃ¡mka
                    {% endif %}
                </div>

                <div>ğŸ“… PoslednÃ­ uÅ¾itÃ­:
                    {% if medicine.last_taken %}
                        {{ medicine.last_taken }}
                    {% else %}
                        NezadÃ¡no
                    {% endif %}
                </div>

                <div>ğŸ—“ Den uÅ¾itÃ­:
                    {% if medicine.day %}
                        {{ medicine.day }}
                    {% else %}
                        NezadÃ¡no
                    {% endif %}
                </div>

                <div>â° ÄŒas uÅ¾itÃ­:
                    {% if medicine.time %}
                        {{ medicine.time }}
                    {% else %}
                        NezadÃ¡no
                    {% endif %}
                </div>
            </small>

            <details class="mt-2">
                <summary class="btn btn-light btn-sm">ğŸ’¬ KomentÃ¡Å™e</summary>
                <ul class="list-group mt-2">
                    {% for comment in medicine.comments.all %}
                        <li class="list-group-item">
                            <strong>{{ comment.user.username }}</strong> ({{ comment.created_at|date:"d.m.Y H:i" }})<br>
                            {{ comment.text }}
                        </li>
                    {% empty %}
                        <li class="list-group-item">ğŸ“­ Å½Ã¡dnÃ© komentÃ¡Å™e.</li>
                    {% endfor %}
                </ul>

                <form method="post" action="{% url 'comment_detail' medicine.id %}">
                    {% csrf_token %}
                    <textarea name="text" class="form-control mt-2" placeholder="PÅ™idejte komentÃ¡Å™..." required></textarea>
                    <button type="submit" class="btn btn-primary btn-sm mt-2">ğŸ’¾ UloÅ¾it komentÃ¡Å™</button>
                </form>
            </details>
          </td>
          <td>{{ medicine.dosage }}</td>
          <td>{{ medicine.remaining_doses }}</td>
          <td>
            <a href="{% url 'take_dose' medicine.id %}" class="btn btn-success btn-sm">ğŸ’Š Take Dose</a>
            <a href="{% url 'edit_medicine' medicine.id %}" class="btn btn-warning btn-sm">âœ Edit</a>
            <a href="{% url 'delete_medicine' medicine.id %}" class="btn btn-danger btn-sm">ğŸ—‘ Delete</a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <a href="{% url 'add_medicine' %}" class="btn btn-primary mt-3">â• Add Medicine</a>

  <div class="mt-3 d-flex gap-2">
    <details>
      <summary class="btn btn-info">ğŸ“– Historie uÅ¾Ã­vÃ¡nÃ­ lÃ©kÅ¯</summary>
      <div class="mt-3">
          <h3 class="mt-4">ğŸ•˜ Historie uÅ¾Ã­vÃ¡nÃ­ lÃ©kÅ¯</h3>
          <table class="table table-bordered">
              <thead>
                  <tr>
                      <th>LÃ©k</th>
                      <th>Datum uÅ¾itÃ­</th>
                  </tr>
              </thead>
              <tbody>
                  {% for entry in history %}
                      <tr>
                          <td>{{ entry.user_medicine.medicine.name }}</td>
                          <td>{{ entry.date|date:"d.m.Y H:i" }}</td>
                      </tr>
                  {% empty %}
                      <tr>
                          <td colspan="2">ğŸ“­ Å½Ã¡dnÃ¡ historie nenÃ­ k dispozici.</td>
                      </tr>
                  {% endfor %}
              </tbody>
          </table>
      </div>
    </details>

    <a href="{% url 'comment_list' %}" class="btn btn-warning">ğŸ’¬ Seznam komentÃ¡Å™Å¯</a>
  </div>

{% endblock %}
